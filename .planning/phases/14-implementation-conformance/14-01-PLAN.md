---
phase: 14-implementation-conformance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/ios/trendy/Services/APIClient.swift
autonomous: true

must_haves:
  truths:
    - "APIClient can be assigned to NetworkClientProtocol variable"
    - "All existing unit tests pass unchanged"
    - "iOS app builds successfully"
  artifacts:
    - path: "apps/ios/trendy/Services/APIClient.swift"
      provides: "NetworkClientProtocol conformance with @unchecked Sendable"
      contains: "extension APIClient: NetworkClientProtocol"
  key_links:
    - from: "apps/ios/trendy/Services/APIClient.swift"
      to: "apps/ios/trendy/Protocols/NetworkClientProtocol.swift"
      via: "protocol conformance extension"
      pattern: "NetworkClientProtocol.*Sendable"
---

<objective>
Add NetworkClientProtocol conformance to APIClient enabling dependency injection for SyncEngine unit testing.

Purpose: Complete protocol conformance for existing types so SyncEngine can accept protocol-based dependencies in Phase 15.

Output: APIClient conforms to NetworkClientProtocol with @unchecked Sendable, verified by successful build and test run.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-implementation-conformance/14-RESEARCH.md

# Prior work
@.planning/phases/13-protocol-definitions/13-01-SUMMARY.md - NetworkClientProtocol definition
@.planning/phases/13-protocol-definitions/13-02-SUMMARY.md - LocalStore already conforms

# Key source files
@apps/ios/trendy/Services/APIClient.swift
@apps/ios/trendy/Protocols/NetworkClientProtocol.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add NetworkClientProtocol conformance to APIClient</name>
  <files>apps/ios/trendy/Services/APIClient.swift</files>
  <action>
Add protocol conformance extension at the end of APIClient.swift, before the APIError enum.

Add these lines after line 591 (the closing brace of the APIClient class):

```swift
// MARK: - Protocol Conformance

/// NetworkClientProtocol conformance for dependency injection.
/// APIClient's methods already match the protocol requirements exactly.
///
/// @unchecked Sendable rationale:
/// - baseURL: String is Sendable (immutable)
/// - session: URLSession is Sendable (thread-safe since iOS 15)
/// - supabaseService: SupabaseService reference, only used for token retrieval
/// - encoder/decoder: JSONEncoder/JSONDecoder are NOT Sendable, but they are:
///   - Only accessed within async methods (serialized access)
///   - Never escape the class instance
///   - Not shared between concurrent operations
extension APIClient: NetworkClientProtocol, @unchecked Sendable {}
```

The extension is empty because all 24 protocol methods already exist in APIClient with compatible signatures. Swift allows methods with default parameter values to satisfy protocol requirements without default values.

Do NOT modify any existing method signatures - the protocol was designed from APIClient's existing API.
  </action>
  <verify>
Build the iOS app to verify protocol conformance compiles:

```bash
cd /Users/cipher/Repositories/trendy/apps/ios && xcodebuild -scheme trendy -destination 'platform=iOS Simulator,name=iPhone 16' build 2>&1 | tail -20
```

Success: "BUILD SUCCEEDED" in output
  </verify>
  <done>APIClient.swift contains `extension APIClient: NetworkClientProtocol, @unchecked Sendable {}` and iOS build succeeds</done>
</task>

<task type="auto">
  <name>Task 2: Verify no behavior changes with test suite</name>
  <files></files>
  <action>
Run the existing iOS unit test suite to verify no behavior changes were introduced.

The conformance extension adds no new code - it only declares that APIClient already satisfies NetworkClientProtocol. All existing tests should pass unchanged.

Run the test suite:
```bash
cd /Users/cipher/Repositories/trendy/apps/ios && xcodebuild test -scheme trendy -destination 'platform=iOS Simulator,name=iPhone 16' 2>&1 | grep -E "(Test Suite|passed|failed|Executed)"
```

Additionally verify no TODO comments exist in protocol files:
```bash
grep -r "TODO" /Users/cipher/Repositories/trendy/apps/ios/trendy/Protocols/ || echo "No TODOs found"
```
  </action>
  <verify>
All tests pass (10 test files, ~10-20 tests total based on file count)
No TODO comments in Protocols directory
  </verify>
  <done>All existing unit tests pass, confirming no behavior changes. Protocol conformance complete with no TODO comments.</done>
</task>

</tasks>

<verification>
Phase success verification:

1. **TEST-04 (APIClient conforms to NetworkClientProtocol):**
   ```bash
   grep "extension APIClient: NetworkClientProtocol" /Users/cipher/Repositories/trendy/apps/ios/trendy/Services/APIClient.swift
   ```
   Expected: Match found

2. **TEST-05 (LocalStore conforms to DataStoreProtocol):**
   ```bash
   grep "struct LocalStore: DataStoreProtocol" /Users/cipher/Repositories/trendy/apps/ios/trendy/Services/Sync/LocalStore.swift
   ```
   Expected: Match found (already done in Phase 13)

3. **All tests pass:**
   Build and test succeeded without failures

4. **No TODO comments:**
   ```bash
   grep -r "TODO" /Users/cipher/Repositories/trendy/apps/ios/trendy/Protocols/
   ```
   Expected: No matches
</verification>

<success_criteria>
1. APIClient conforms to NetworkClientProtocol (compiler-verified via build)
2. LocalStore conforms to DataStoreProtocol (already done in Phase 13)
3. All existing unit tests pass (no behavior changes)
4. DefaultDataStoreFactory exists and compiles (already done in Phase 13)
5. Protocol conformance complete with no TODO comments
</success_criteria>

<output>
After completion, create `.planning/phases/14-implementation-conformance/14-01-SUMMARY.md`
</output>
