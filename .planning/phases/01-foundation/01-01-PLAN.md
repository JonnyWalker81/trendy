---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/ios/trendy/Services/HealthKitService.swift
autonomous: true

must_haves:
  truths:
    - "All HealthKitService logging uses structured Log.healthKit.* calls"
    - "No print() statements remain in HealthKitService.swift"
    - "Debug-only logging is properly guarded with #if DEBUG"
  artifacts:
    - path: "apps/ios/trendy/Services/HealthKitService.swift"
      provides: "HealthKit monitoring with structured logging"
      contains: "Log.healthKit"
  key_links:
    - from: "HealthKitService.swift"
      to: "Log.healthKit"
      via: "structured logging calls"
      pattern: "Log\\.healthKit\\."
---

<objective>
Replace all print() statements in HealthKitService.swift with structured Log.healthKit.* calls.

Purpose: Establish consistent, production-ready logging that integrates with Apple's unified logging system. This enables proper log filtering by category and severity in Console.app and prevents debug noise from appearing in production builds.

Output: HealthKitService.swift with 0 print() statements and structured logging throughout.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing logging infrastructure - use this pattern:
@apps/ios/trendy/Utilities/Logger.swift

# Target file for this plan:
@apps/ios/trendy/Services/HealthKitService.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace print() with Log.healthKit in HealthKitService.swift</name>
  <files>apps/ios/trendy/Services/HealthKitService.swift</files>
  <action>
    Replace all 78 print() statements with appropriate Log.healthKit.* calls:

    **Mapping rules:**
    - `print("‚úÖ ...` (success messages) ‚Üí `Log.healthKit.info(...)`
    - `print("‚ùå ...` or `print("‚ö†Ô∏è ...` (errors/warnings) ‚Üí `Log.healthKit.warning(...)` or `Log.healthKit.error(...)`
    - `print("üìä ...` or `print("üì± ...` (debug info) ‚Üí `Log.healthKit.debug(...)`
    - `print("üîç ...` (verbose tracing) ‚Üí `Log.healthKit.debug(...)` wrapped in `#if DEBUG`
    - Multi-line print blocks ‚Üí Single Log.* call with context builder

    **Context patterns to use:**
    ```swift
    // For simple messages:
    Log.healthKit.info("Authorization completed")

    // For messages with data:
    Log.healthKit.debug("Monitoring categories", context: .with { ctx in
        ctx.add("count", enabledCategories.count)
    })

    // For errors:
    Log.healthKit.error("Failed to save", error: error)
    ```

    **Specific transformations:**
    1. Lines 38-40 (App Group warnings): Consolidate into single `Log.healthKit.warning()` with context
    2. Lines 76 (category restoration): `Log.healthKit.debug()`
    3. Lines 189-195 (verification): Keep in #if DEBUG, use `Log.healthKit.debug()`
    4. Lines 204-212 (state logging): Keep in #if DEBUG, use `Log.healthKit.debug()`
    5. All migration prints (232-258): `Log.healthKit.info()`
    6. Error cases: Convert to `Log.healthKit.error()` or `Log.healthKit.warning()` based on severity

    **DO NOT:**
    - Change any business logic
    - Modify function signatures
    - Change error handling flow (just replace print with Log)
    - Remove #if DEBUG guards that already exist
  </action>
  <verify>
    ```bash
    grep -c "print(" apps/ios/trendy/Services/HealthKitService.swift
    # Expected: 0

    grep -c "Log.healthKit" apps/ios/trendy/Services/HealthKitService.swift
    # Expected: 78+ (roughly same as print count, possibly more due to consolidation)
    ```
  </verify>
  <done>
    - Zero print() statements in HealthKitService.swift
    - All logging uses Log.healthKit.* pattern
    - File still compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Ensure debug logging is properly guarded</name>
  <files>apps/ios/trendy/Services/HealthKitService.swift</files>
  <action>
    Review all Log.healthKit.debug() calls and ensure verbose debugging is wrapped in #if DEBUG:

    **Rules:**
    - State dumps (like logCurrentState()) ‚Üí Must be in #if DEBUG
    - Verbose tracing (every query execution) ‚Üí Should be in #if DEBUG
    - Normal operational logging (authorization completed, monitoring started) ‚Üí OK outside #if DEBUG as info level

    **Add #if DEBUG guards around:**
    - Any Log.healthKit.debug() calls that produce high-volume output
    - Methods like `logCurrentState()` that dump internal state

    **Keep outside #if DEBUG:**
    - `Log.healthKit.info()` for significant events (auth completed, monitoring started)
    - `Log.healthKit.warning()` for recoverable issues
    - `Log.healthKit.error()` for failures

    Check the existing #if DEBUG block at line 170-172 and ensure logCurrentState() uses Log.* internally.
  </action>
  <verify>
    ```bash
    # Build should succeed in both Debug and Release
    cd apps/ios && xcodebuild -scheme "trendy (Local)" -configuration Debug build CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO 2>&1 | tail -20
    ```
  </verify>
  <done>
    - High-volume debug logging is guarded with #if DEBUG
    - Production builds have minimal logging overhead
    - Build succeeds in Debug configuration
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `grep -c "print(" apps/ios/trendy/Services/HealthKitService.swift` returns 0
- [ ] `grep -c "Log.healthKit" apps/ios/trendy/Services/HealthKitService.swift` returns 60+
- [ ] Xcode build succeeds without errors
- [ ] No unguarded high-volume debug logging in production
</verification>

<success_criteria>

- All 78 print() statements replaced with Log.healthKit.* calls
- Logging levels appropriately chosen (debug/info/warning/error)
- Debug-only verbose logging wrapped in #if DEBUG
- File compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
