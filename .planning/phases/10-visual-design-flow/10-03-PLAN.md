---
phase: 10-visual-design-flow
plan: 03
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - apps/ios/trendy/Views/Onboarding/Screens/NotificationPrimingScreen.swift
  - apps/ios/trendy/Views/Onboarding/Screens/LocationPrimingScreen.swift
  - apps/ios/trendy/Views/Onboarding/Screens/HealthKitPrimingScreen.swift
  - apps/ios/trendy/Models/Onboarding/OnboardingAnalytics.swift
autonomous: true

must_haves:
  truths:
    - "Each permission has its own dedicated full-screen priming view"
    - "Priming screens show contextual benefit messaging before system dialog"
    - "Skip option visible as subtle text link (not prominent button)"
    - "Enable button triggers actual system permission request"
  artifacts:
    - path: "apps/ios/trendy/Views/Onboarding/Screens/NotificationPrimingScreen.swift"
      provides: "Notification permission priming screen"
      contains: "OnboardingHeroView"
    - path: "apps/ios/trendy/Views/Onboarding/Screens/LocationPrimingScreen.swift"
      provides: "Location permission priming screen"
      contains: "OnboardingHeroView"
    - path: "apps/ios/trendy/Views/Onboarding/Screens/HealthKitPrimingScreen.swift"
      provides: "HealthKit permission priming screen"
      contains: "OnboardingHeroView"
    - path: "apps/ios/trendy/Models/Onboarding/OnboardingAnalytics.swift"
      provides: "Enhanced permission metadata for priming screens"
      contains: "skipExplanation"
  key_links:
    - from: "NotificationPrimingScreen"
      to: "OnboardingProgressBar"
      via: "Progress indication"
      pattern: "OnboardingProgressBar\\("
    - from: "LocationPrimingScreen"
      to: "OnboardingHeroView"
      via: "Hero layout"
      pattern: "OnboardingHeroView\\("
    - from: "HealthKitPrimingScreen"
      to: "onSkip callback"
      via: "Skip navigation"
      pattern: "onSkip\\("
---

<objective>
Create dedicated full-screen priming views for each permission type.

Purpose: Per FLOW-02, users should see custom priming screens before each system permission dialog. This explains the value of each permission and gives users an informed choice. Addresses FLOW-02 (pre-permission priming), FLOW-03 (skip option), and FLOW-04 (contextual benefit messaging).

Output: Three new permission priming screens (Notification, Location, HealthKit) in the Screens directory, plus updated permission metadata in OnboardingAnalytics.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-visual-design-flow/10-CONTEXT.md
@.planning/phases/10-visual-design-flow/10-RESEARCH.md
@.planning/phases/10-visual-design-flow/10-01-SUMMARY.md

# Existing permission types and messaging
@apps/ios/trendy/Models/Onboarding/OnboardingAnalytics.swift

# Existing permissions view (for reference - will be replaced in Plan 04)
@apps/ios/trendy/Views/Onboarding/PermissionsView.swift

# Component files created in Plan 01
@apps/ios/trendy/Views/Onboarding/Components/OnboardingHeroView.swift
@apps/ios/trendy/Views/Onboarding/Components/OnboardingProgressBar.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance OnboardingPermissionType with Skip Messaging</name>
  <files>apps/ios/trendy/Models/Onboarding/OnboardingAnalytics.swift</files>
  <action>
Add new properties to OnboardingPermissionType enum to support skip messaging per FLOW-03.

Add these computed properties to the enum:

1. `skipExplanation: String` - Brief text explaining what user misses when skipping
   - notifications: "You won't receive reminders to log events"
   - location: "Auto-logging for locations like gym or home won't work"
   - healthkit: "Workout and health data won't sync automatically"

2. `benefitBullets: [String]` - 2-3 bullet points for the priming screen (more detailed than promptDescription)
   - notifications: ["Get reminded to log daily habits", "See streak notifications", "Weekly summary reports"]
   - location: ["Auto-log when you arrive at gym", "Track commute patterns", "No manual logging needed"]
   - healthkit: ["Import workouts from Apple Watch", "Track steps automatically", "See health trends in one place"]

3. `gradientColors: [Color]` - Specific gradient for each permission's hero
   - notifications: [Color.orange, Color.red]
   - location: [Color.blue, Color.purple]
   - healthkit: [Color.pink, Color.red]

Keep all existing properties (displayName, iconName, promptTitle, promptDescription, enableButtonText).

These properties will be used by the priming screens for consistent messaging.
  </action>
  <verify>
1. File compiles without errors
2. Build succeeds
3. All three permissions have all new properties defined
  </verify>
  <done>OnboardingPermissionType has skipExplanation, benefitBullets, and gradientColors properties</done>
</task>

<task type="auto">
  <name>Task 2: Create Permission Priming Screens</name>
  <files>
    apps/ios/trendy/Views/Onboarding/Screens/NotificationPrimingScreen.swift
    apps/ios/trendy/Views/Onboarding/Screens/LocationPrimingScreen.swift
    apps/ios/trendy/Views/Onboarding/Screens/HealthKitPrimingScreen.swift
  </files>
  <action>
Create the Screens directory and three permission priming screen files.

**Shared structure for all three screens:**

Each screen is a SwiftUI View with this signature:
```swift
struct [Permission]PrimingScreen: View {
    let progress: Double  // 0.0 to 1.0 for progress bar
    let onEnable: () async -> Void  // Callback when user taps Enable
    let onSkip: () -> Void  // Callback when user taps Skip
}
```

**Layout (top to bottom):**
1. OnboardingProgressBar at top
   - progress: passed in parameter
   - Padding: horizontal 24, top 8

2. OnboardingHeroView
   - symbolName: from OnboardingPermissionType.iconName
   - gradientColors: from OnboardingPermissionType.gradientColors
   - height: 280 (standard)

3. Spacer

4. Content area (centered):
   - Title: from OnboardingPermissionType.promptTitle (bold, .title font)
   - Benefit bullets from OnboardingPermissionType.benefitBullets
     - Each bullet has checkmark icon + text
     - Muted foreground color
     - Left-aligned with padding
   - Padding: horizontal 32

5. Spacer

6. Action area (pinned at bottom):
   - Primary button: "Enable [Permission]" from enableButtonText
     - On tap: call onEnable() async, show loading indicator during
   - Skip link: "Skip for now" as subtle text link (Color.dsMutedForeground)
     - On tap: call onSkip()
   - Skip explanation text: from skipExplanation (very small, muted)
     - Only show AFTER user taps skip (state variable)
   - Padding: horizontal 32, bottom 40

**Per CONTEXT.md decisions:**
- Full screen priming screens (same layout as other onboarding)
- Subtle text link for Skip option (not prominent)
- Brief inline text explains what user misses when skipping
- Button text: "Enable [Permission]" (explicit about what's next)

**Add state for loading and skip confirmation:**
```swift
@State private var isLoading = false
@State private var showSkipExplanation = false
```

When skip tapped:
1. Set showSkipExplanation = true
2. After 1.5 seconds, call onSkip() (let user see explanation)

Add haptic feedback on Enable button tap.

Include SwiftUI Preview for each screen.

NOTE: These screens will be wired into the onboarding flow in Plan 04. For now they are standalone components.
  </action>
  <verify>
1. All three files exist in Screens directory
2. Build succeeds: `cd apps/ios && xcodebuild -scheme trendy -destination 'platform=iOS Simulator,name=iPhone 16 Pro' build 2>&1 | grep -E "(error:|BUILD)"`
3. Each screen has onEnable, onSkip callbacks
4. Previews render correctly
  </verify>
  <done>Three permission priming screens created with hero layout, benefit bullets, and skip messaging</done>
</task>

</tasks>

<verification>
After all tasks:
1. Project builds without errors
2. OnboardingPermissionType has new properties for skip messaging
3. Three priming screen files exist in Screens directory
4. Each screen uses OnboardingHeroView and OnboardingProgressBar
5. Each screen has Enable button and Skip link
6. Skip explanation appears when skip is tapped
</verification>

<success_criteria>
1. `apps/ios/trendy/Views/Onboarding/Screens/` directory exists with 3 Swift files
2. OnboardingAnalytics.swift updated with skipExplanation, benefitBullets, gradientColors
3. `xcodebuild build` succeeds
4. Each priming screen accepts progress, onEnable, onSkip parameters
5. Priming screens follow CONTEXT.md layout (hero top, buttons bottom, content middle)
6. Skip flow shows explanation before proceeding
</success_criteria>

<output>
After completion, create `.planning/phases/10-visual-design-flow/10-03-SUMMARY.md`
</output>
