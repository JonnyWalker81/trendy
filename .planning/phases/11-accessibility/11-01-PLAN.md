---
phase: 11-accessibility
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/ios/trendy/Views/Onboarding/Components/OnboardingProgressBar.swift
  - apps/ios/trendy/Views/Onboarding/Components/OnboardingHeroView.swift
  - apps/ios/trendy/Views/Onboarding/OnboardingContainerView.swift
autonomous: true

must_haves:
  truths:
    - "Progress bar announces step name and position to VoiceOver"
    - "Hero images are not read by VoiceOver"
    - "Hero pulse animation respects Reduce Motion setting"
    - "Progress bar animation respects Reduce Motion setting"
    - "VoiceOver focus moves to step title when transitioning between onboarding steps"
    - "Step transitions respect Reduce Motion setting"
  artifacts:
    - path: "apps/ios/trendy/Views/Onboarding/Components/OnboardingProgressBar.swift"
      provides: "Accessible progress bar with step context"
      contains: "accessibilityLabel"
    - path: "apps/ios/trendy/Views/Onboarding/Components/OnboardingHeroView.swift"
      provides: "Hero view hidden from VoiceOver, respects reduceMotion"
      contains: "accessibilityHidden"
    - path: "apps/ios/trendy/Views/Onboarding/OnboardingContainerView.swift"
      provides: "Focus management and reduce motion transitions"
      contains: "AccessibilityFocusState"
  key_links:
    - from: "OnboardingProgressBar"
      to: "VoiceOver"
      via: "accessibilityLabel + accessibilityValue"
      pattern: "accessibilityValue.*step.*of"
    - from: "OnboardingNavigationView"
      to: "OnboardingStep"
      via: "onChange focus binding"
      pattern: "onChange.*currentStep"
---

<objective>
Add accessibility infrastructure to shared onboarding components and navigation container.

Purpose: Enable VoiceOver support and Reduce Motion compliance across all onboarding screens by updating the foundation components they share.

Output: Updated OnboardingProgressBar with VoiceOver step announcements, OnboardingHeroView hidden from VoiceOver with reduceMotion-aware animation, and OnboardingNavigationView with focus management for step transitions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-accessibility/11-RESEARCH.md
@.planning/phases/11-accessibility/11-CONTEXT.md

Reference existing accessibility pattern:
@apps/ios/trendy/Views/Components/SyncIndicator/SyncErrorView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add accessibility to OnboardingProgressBar and OnboardingHeroView</name>
  <files>
    apps/ios/trendy/Views/Onboarding/Components/OnboardingProgressBar.swift
    apps/ios/trendy/Views/Onboarding/Components/OnboardingHeroView.swift
  </files>
  <action>
Update OnboardingProgressBar:
1. Add new parameters: `stepName: String`, `stepNumber: Int`, `totalSteps: Int`
2. Add `@Environment(\.accessibilityReduceMotion) private var reduceMotion`
3. Make animation conditional: `.animation(reduceMotion ? nil : .spring(response: 0.3, dampingFraction: 0.8), value: progress)`
4. Add accessibility modifiers:
   - `.accessibilityLabel("Onboarding progress")`
   - `.accessibilityValue("\(stepName), step \(stepNumber) of \(totalSteps)")`

Update OnboardingHeroView:
1. Add `@Environment(\.accessibilityReduceMotion) private var reduceMotion`
2. Update the animation condition to also check reduceMotion:
   - Change `.scaleEffect(symbolAnimation && isPulsing ? 1.05 : 1.0)` to `.scaleEffect(symbolAnimation && !reduceMotion && isPulsing ? 1.05 : 1.0)`
   - Update animation modifier to check reduceMotion too
3. Add `.accessibilityHidden(true)` to the entire ZStack (hero is decorative)
4. Update `onAppear` to only set `isPulsing = true` if `symbolAnimation && !reduceMotion`

Both files: Update previews to show new parameters where needed. Keep existing preview functionality working.
  </action>
  <verify>
Build the iOS app with `cd /Users/cipher/Repositories/trendy && just build-ios` - no compiler errors. Preview both components in Xcode to confirm they render correctly.
  </verify>
  <done>
OnboardingProgressBar accepts step context and announces "Step N of M" to VoiceOver. OnboardingHeroView is hidden from VoiceOver and pulse animation stops when Reduce Motion is enabled.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add focus management and reduceMotion to OnboardingNavigationView</name>
  <files>
    apps/ios/trendy/Views/Onboarding/OnboardingContainerView.swift
  </files>
  <action>
Update OnboardingNavigationView in OnboardingContainerView.swift:

1. Add focus state enum inside OnboardingNavigationView:
```swift
enum OnboardingFocusField: Hashable {
    case welcome, auth, createEvent, logEvent, permissions, finish
}
```

2. Add properties:
```swift
@AccessibilityFocusState private var focusedField: OnboardingFocusField?
@Environment(\.accessibilityReduceMotion) private var reduceMotion
```

3. Update the transition to respect reduceMotion:
```swift
.transition(reduceMotion ? .opacity : .asymmetric(
    insertion: .move(edge: .trailing).combined(with: .opacity),
    removal: .move(edge: .leading).combined(with: .opacity)
))
.animation(reduceMotion ? nil : .spring(response: 0.25, dampingFraction: 0.7), value: viewModel.currentStep)
```

4. Add onChange handler to move focus when step changes:
```swift
.onChange(of: viewModel.currentStep) { _, newStep in
    DispatchQueue.main.asyncAfter(deadline: .now() + 0.1) {
        focusedField = focusField(for: newStep)
    }
}
```

5. Add helper function:
```swift
private func focusField(for step: OnboardingStep) -> OnboardingFocusField {
    switch step {
    case .welcome: return .welcome
    case .auth: return .auth
    case .createEventType: return .createEvent
    case .logFirstEvent: return .logEvent
    case .permissions: return .permissions
    case .finish: return .finish
    }
}
```

6. Update OnboardingLoadingView to respect reduceMotion:
- Add `@Environment(\.accessibilityReduceMotion) private var reduceMotion`
- Make pulse animation conditional on `!reduceMotion`
- Add `.accessibilityHidden(true)` to the loading icon (decorative)

Note: The focusedField binding will be passed to individual views in Plan 02 where they'll use `.accessibilityFocused($focusedField, equals: .welcome)` on their titles.
  </action>
  <verify>
Build the iOS app with `cd /Users/cipher/Repositories/trendy && just build-ios` - no compiler errors. Run in simulator with Reduce Motion enabled (Settings > Accessibility > Motion > Reduce Motion) and confirm step transitions are instant (opacity only, no slide).
  </verify>
  <done>
OnboardingNavigationView has focus state management infrastructure ready for individual views. Step transitions use opacity-only transition when Reduce Motion is enabled. Loading view animation respects Reduce Motion.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update all progress bar call sites with step context</name>
  <files>
    apps/ios/trendy/Views/Onboarding/WelcomeView.swift
    apps/ios/trendy/Views/Onboarding/OnboardingAuthView.swift
    apps/ios/trendy/Views/Onboarding/CreateEventTypeView.swift
    apps/ios/trendy/Views/Onboarding/LogFirstEventView.swift
    apps/ios/trendy/Views/Onboarding/OnboardingFinishView.swift
    apps/ios/trendy/Views/Onboarding/Screens/NotificationPrimingScreen.swift
    apps/ios/trendy/Views/Onboarding/Screens/LocationPrimingScreen.swift
    apps/ios/trendy/Views/Onboarding/Screens/HealthKitPrimingScreen.swift
  </files>
  <action>
Update all OnboardingProgressBar usages to include the new required parameters.

Step names and numbers for each screen (6 total steps):
1. Welcome: stepName: "Welcome", stepNumber: 1
2. Auth: stepName: "Account", stepNumber: 2
3. CreateEventType: stepName: "Event Type", stepNumber: 3
4. LogFirstEvent: stepName: "First Event", stepNumber: 4
5. Permissions (Notifications): stepName: "Notifications", stepNumber: 5
5. Permissions (Location): stepName: "Location", stepNumber: 5
5. Permissions (HealthKit): stepName: "Health", stepNumber: 5
6. Finish: stepName: "Complete", stepNumber: 6

All use totalSteps: 6.

Example update in WelcomeView:
```swift
OnboardingProgressBar(
    progress: 0.0,
    stepName: "Welcome",
    stepNumber: 1,
    totalSteps: 6
)
```

For permission priming screens, update the progress bar to use the step context. Since they receive `progress` as a parameter and permissions is step 5:
- NotificationPrimingScreen: stepName: "Notifications"
- LocationPrimingScreen: stepName: "Location"
- HealthKitPrimingScreen: stepName: "Health"
All three use stepNumber: 5, totalSteps: 6.
  </action>
  <verify>
Build the iOS app with `cd /Users/cipher/Repositories/trendy && just build-ios` - no compiler errors. Run VoiceOver in simulator and navigate to a progress bar - it should announce the step name and position.
  </verify>
  <done>
All OnboardingProgressBar instances include step context. VoiceOver announces step name and position when focused on progress bar.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `cd /Users/cipher/Repositories/trendy && just build-ios`
2. Enable Reduce Motion in iOS Simulator (Settings > Accessibility > Motion > Reduce Motion)
3. Run app and go through onboarding - transitions should be instant/crossfade (no sliding)
4. Hero icons should not pulse
5. Enable VoiceOver (Settings > Accessibility > VoiceOver)
6. Navigate to progress bar - should hear step context
7. Hero images should be skipped by VoiceOver
</verification>

<success_criteria>
- OnboardingProgressBar has accessibility label and value with step context
- OnboardingHeroView is hidden from VoiceOver
- All animations respect Reduce Motion setting
- OnboardingNavigationView has focus state enum and reduceMotion-aware transitions
- All progress bar call sites updated with new parameters
- Build succeeds with no warnings related to accessibility
</success_criteria>

<output>
After completion, create `.planning/phases/11-accessibility/11-01-SUMMARY.md`
</output>
