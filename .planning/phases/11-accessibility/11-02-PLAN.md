---
phase: 11-accessibility
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - apps/ios/trendy/Views/Onboarding/WelcomeView.swift
  - apps/ios/trendy/Views/Onboarding/OnboardingAuthView.swift
  - apps/ios/trendy/Views/Onboarding/CreateEventTypeView.swift
  - apps/ios/trendy/Views/Onboarding/LogFirstEventView.swift
  - apps/ios/trendy/Views/Onboarding/PermissionsView.swift
  - apps/ios/trendy/Views/Onboarding/Screens/NotificationPrimingScreen.swift
  - apps/ios/trendy/Views/Onboarding/Screens/LocationPrimingScreen.swift
  - apps/ios/trendy/Views/Onboarding/Screens/HealthKitPrimingScreen.swift
  - apps/ios/trendy/Views/Onboarding/OnboardingFinishView.swift
  - apps/ios/trendy/Views/Onboarding/OnboardingContainerView.swift
autonomous: true

must_haves:
  truths:
    - "VoiceOver user can complete entire onboarding flow without sighted assistance"
    - "All buttons have contextual labels describing their action"
    - "Decorative elements (icons in feature highlights, template icons) are hidden from VoiceOver"
    - "Focus moves to title when each step appears"
    - "Confetti respects Reduce Motion (disabled or shows static success indicator)"
    - "Skip explanation has extra time when VoiceOver is running"
  artifacts:
    - path: "apps/ios/trendy/Views/Onboarding/WelcomeView.swift"
      provides: "Accessible welcome screen with labeled buttons"
      contains: "accessibilityLabel"
    - path: "apps/ios/trendy/Views/Onboarding/OnboardingAuthView.swift"
      provides: "Accessible auth screen with form labels"
      contains: "accessibilityLabel"
    - path: "apps/ios/trendy/Views/Onboarding/OnboardingFinishView.swift"
      provides: "Accessible finish screen with reduceMotion confetti handling"
      contains: "accessibilityReduceMotion"
  key_links:
    - from: "WelcomeView title"
      to: "AccessibilityFocusState"
      via: "accessibilityFocused binding"
      pattern: "accessibilityFocused"
    - from: "OnboardingFinishView confetti"
      to: "reduceMotion"
      via: "conditional num parameter"
      pattern: "reduceMotion.*num.*0"
---

<objective>
Add VoiceOver labels, hints, and focus bindings to all individual onboarding screens.

Purpose: Enable VoiceOver users to complete the entire onboarding flow with clear navigation and contextual button descriptions.

Output: All onboarding screens with proper accessibility labels, decorative elements hidden, focus management on titles, and Reduce Motion-aware animations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-accessibility/11-RESEARCH.md
@.planning/phases/11-accessibility/11-CONTEXT.md
@.planning/phases/11-accessibility/11-01-SUMMARY.md

Reference existing accessibility pattern:
@apps/ios/trendy/Views/Components/SyncIndicator/SyncErrorView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add accessibility to WelcomeView and OnboardingAuthView</name>
  <files>
    apps/ios/trendy/Views/Onboarding/WelcomeView.swift
    apps/ios/trendy/Views/Onboarding/OnboardingAuthView.swift
    apps/ios/trendy/Views/Onboarding/OnboardingContainerView.swift
  </files>
  <action>
First, update OnboardingContainerView to pass focus binding to child views:

1. In OnboardingNavigationView, update each case to pass focusedField binding:
```swift
case .welcome:
    WelcomeView(viewModel: viewModel, focusedField: $focusedField)
        .id(OnboardingStep.welcome)
case .auth:
    OnboardingAuthView(viewModel: viewModel, focusedField: $focusedField)
        .id(OnboardingStep.auth)
// ... similar for other views
```

Update WelcomeView:
1. Add parameter: `@AccessibilityFocusState.Binding var focusedField: OnboardingNavigationView.OnboardingFocusField?`
2. Add `.accessibilityAddTraits(.isHeader)` to "Track anything." title
3. Add `.accessibilityFocused($focusedField, equals: .welcome)` to "Track anything." title
4. Update "Get Started" button:
   - `.accessibilityLabel("Get started")`
   - `.accessibilityHint("Creates your account to begin tracking")`
5. Update "I already have an account" button:
   - `.accessibilityLabel("Sign in to existing account")`
   - `.accessibilityHint("Opens sign in form")`
6. In FeatureHighlightRow, use `.accessibilityElement(children: .combine)` on the HStack to group icon + text
7. Hide the icon from VoiceOver: `.accessibilityHidden(true)` on the Image

Update OnboardingAuthView:
1. Add parameter: `@AccessibilityFocusState.Binding var focusedField: OnboardingNavigationView.OnboardingFocusField?`
2. Add `.accessibilityAddTraits(.isHeader)` to the title ("Welcome Back" or "Create Account")
3. Add `.accessibilityFocused($focusedField, equals: .auth)` to the title
4. Update form field labels to be more descriptive:
   - Email: `.accessibilityLabel("Email address")`
   - Password: `.accessibilityLabel(isSignIn ? "Password" : "Choose a password")`
   - Confirm Password: `.accessibilityLabel("Confirm your password")`
5. Update submit button:
   - `.accessibilityLabel(isSignIn ? "Sign in" : "Create account")`
   - `.accessibilityHint(isSignIn ? "Signs into your existing account" : "Creates your new account")`
6. Update toggle button (Don't have an account?):
   - `.accessibilityLabel(isSignIn ? "Switch to sign up" : "Switch to sign in")`
7. Update Google Sign-In button in GoogleSignInButton:
   - `.accessibilityLabel("Continue with Google")`
   - `.accessibilityHint("Signs in using your Google account")`
8. Update Back button:
   - `.accessibilityLabel("Go back")`
   - `.accessibilityHint("Returns to welcome screen")`
9. Hide hero view from VoiceOver (already done by OnboardingHeroView in Plan 01)
10. Add `.accessibilityHidden(true)` to the "or" divider (decorative)
  </action>
  <verify>
Build with `cd /Users/cipher/Repositories/trendy && just build-ios`. Enable VoiceOver in simulator, navigate through WelcomeView and OnboardingAuthView - all buttons should have descriptive labels.
  </verify>
  <done>
WelcomeView and OnboardingAuthView have complete VoiceOver support with contextual button labels, grouped feature highlights, and focus on titles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add accessibility to CreateEventTypeView and LogFirstEventView</name>
  <files>
    apps/ios/trendy/Views/Onboarding/CreateEventTypeView.swift
    apps/ios/trendy/Views/Onboarding/LogFirstEventView.swift
    apps/ios/trendy/Views/Onboarding/OnboardingContainerView.swift
  </files>
  <action>
Update OnboardingContainerView cases:
```swift
case .createEventType:
    CreateEventTypeView(viewModel: viewModel, focusedField: $focusedField)
        .environment(eventStore)
        .id(OnboardingStep.createEventType)
case .logFirstEvent:
    LogFirstEventView(viewModel: viewModel, focusedField: $focusedField)
        .environment(eventStore)
        .id(OnboardingStep.logFirstEvent)
```

Update CreateEventTypeView:
1. Add parameter: `@AccessibilityFocusState.Binding var focusedField: OnboardingNavigationView.OnboardingFocusField?`
2. Add `.accessibilityAddTraits(.isHeader)` and `.accessibilityFocused($focusedField, equals: .createEvent)` to "What will you track?" title
3. In TemplateCard, add accessibility:
   - `.accessibilityLabel("\(template.name). \(template.description)")`
   - `.accessibilityHint(template.isCustom ? "Opens custom event type form" : "Creates this event type")`
   - `.accessibilityAddTraits(.isButton)` (since it's a Button, this should be automatic)
4. Hide template card icons from VoiceOver (they're in the label now)
5. In custom form:
   - Name field: `.accessibilityLabel("Event type name")`
   - Color picker: Group all colors and add `.accessibilityLabel("Color: \(selectedColor.accessibilityName)")` where you add a computed property for color names
   - Each color circle: `.accessibilityLabel(colorName)` and `.accessibilityAddTraits(selectedColor == color ? .isSelected : [])`
   - Icon picker: Similar pattern with icon names
   - Each icon: `.accessibilityLabel(iconAccessibilityName)` and `.accessibilityAddTraits(selectedIcon == icon ? .isSelected : [])`
   - Create button: `.accessibilityLabel("Create event type")` `.accessibilityHint("Creates your custom event type")`
6. Skip button: `.accessibilityLabel("Skip event type creation")` `.accessibilityHint("Uses your existing event types instead")`

Update LogFirstEventView:
1. Add parameter: `@AccessibilityFocusState.Binding var focusedField: OnboardingNavigationView.OnboardingFocusField?`
2. Add `.accessibilityAddTraits(.isHeader)` and `.accessibilityFocused($focusedField, equals: .logEvent)` to "Log your first event" title
3. Add `@Environment(\.accessibilityReduceMotion) private var reduceMotion`
4. In successView, make animation conditional on !reduceMotion
5. Event type display (icon + name): Group with `.accessibilityElement(children: .combine)`
6. Notes field: `.accessibilityLabel("Optional note for this event")`
7. Log button: `.accessibilityLabel("Log event now")` `.accessibilityHint("Records your first event")`
8. Skip button: `.accessibilityLabel("Skip logging first event")` `.accessibilityHint("Continues without logging")`
9. Success checkmark: `.accessibilityLabel("Success! First event logged.")`

Note for color/icon accessibility names: Add a private helper that maps common colors/icons to readable names. For colors, you can use the color's description or define a mapping. For icons, map SF Symbol names to human-readable names (e.g., "heart.fill" -> "Heart").
  </action>
  <verify>
Build with `cd /Users/cipher/Repositories/trendy && just build-ios`. Enable VoiceOver, navigate through CreateEventTypeView - template cards should announce their name and description. Color/icon pickers should announce selection state.
  </verify>
  <done>
CreateEventTypeView and LogFirstEventView have complete VoiceOver support with template card labels, color/icon picker accessibility, and success animation respecting Reduce Motion.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add accessibility to permission priming screens and OnboardingFinishView</name>
  <files>
    apps/ios/trendy/Views/Onboarding/PermissionsView.swift
    apps/ios/trendy/Views/Onboarding/Screens/NotificationPrimingScreen.swift
    apps/ios/trendy/Views/Onboarding/Screens/LocationPrimingScreen.swift
    apps/ios/trendy/Views/Onboarding/Screens/HealthKitPrimingScreen.swift
    apps/ios/trendy/Views/Onboarding/OnboardingFinishView.swift
    apps/ios/trendy/Views/Onboarding/OnboardingContainerView.swift
  </files>
  <action>
Update OnboardingContainerView cases:
```swift
case .permissions:
    PermissionsView(viewModel: viewModel, focusedField: $focusedField)
        .id(OnboardingStep.permissions)
case .finish:
    OnboardingFinishView(viewModel: viewModel, focusedField: $focusedField)
        .id(OnboardingStep.finish)
```

Update PermissionsView:
1. Add parameter: `@AccessibilityFocusState.Binding var focusedField: OnboardingNavigationView.OnboardingFocusField?`
2. Add `@Environment(\.accessibilityReduceMotion) private var reduceMotion`
3. Update transition to respect reduceMotion (similar to OnboardingNavigationView)
4. Pass focusedField to priming screens (they'll focus on their title, all map to .permissions)

Update all three priming screens (NotificationPrimingScreen, LocationPrimingScreen, HealthKitPrimingScreen):
1. Add parameter: `let focusedField: AccessibilityFocusState<OnboardingNavigationView.OnboardingFocusField?>.Binding`
2. Add `@Environment(\.accessibilityReduceMotion) private var reduceMotion`
3. Add `.accessibilityAddTraits(.isHeader)` and `.accessibilityFocused(focusedField, equals: .permissions)` to the title
4. Benefit bullets: Group each HStack with `.accessibilityElement(children: .combine)`, hide checkmark icons
5. Enable button contextual labels:
   - Notification: `.accessibilityLabel("Enable notifications")` `.accessibilityHint("Shows iOS permission dialog. Allows reminders to track your events.")`
   - Location: `.accessibilityLabel("Enable location")` `.accessibilityHint("Shows iOS permission dialog. Allows automatic event logging at places you visit.")`
   - HealthKit: `.accessibilityLabel("Enable health access")` `.accessibilityHint("Shows iOS permission dialog. Allows importing workouts and health data.")`
6. Skip button contextual labels:
   - Notification: `.accessibilityLabel("Skip notification setup")` `.accessibilityHint("You can enable notifications later in Settings.")`
   - Location: `.accessibilityLabel("Skip location setup")` `.accessibilityHint("You can enable location tracking later in Settings.")`
   - HealthKit: `.accessibilityLabel("Skip health access")` `.accessibilityHint("You can connect health data later in Settings.")`
7. Skip explanation: Check `UIAccessibility.isVoiceOverRunning` and extend delay from 1.5s to 3.0s if VoiceOver is active
8. Make skip explanation animation respect reduceMotion
9. Hide hero from VoiceOver (already done in Plan 01)

Update OnboardingFinishView:
1. Add parameter: `@AccessibilityFocusState.Binding var focusedField: OnboardingNavigationView.OnboardingFocusField?`
2. Add `@Environment(\.accessibilityReduceMotion) private var reduceMotion`
3. Add `.accessibilityAddTraits(.isHeader)` and `.accessibilityFocused($focusedField, equals: .finish)` to "You're all set!" title
4. Update confetti cannon to respect reduceMotion:
   - Change `num: 50` to `num: reduceMotion ? 0 : 50`
   - Change `hapticFeedback: true` to `hapticFeedback: !reduceMotion`
5. Only trigger confetti if `!reduceMotion` in onAppear
6. Make checkmark/content animations conditional on `!reduceMotion` (instant appear if reduceMotion)
7. Success checkmark: `.accessibilityLabel("Success checkmark")`
8. SummaryCard: Group and add `.accessibilityLabel("Ready to track \(eventType.name)")`
9. CTA button: `.accessibilityLabel("Go to dashboard")` `.accessibilityHint("Completes setup and opens the main app")`
  </action>
  <verify>
Build with `cd /Users/cipher/Repositories/trendy && just build-ios`. Test with VoiceOver: navigate through permission priming screens, verify enable/skip buttons have contextual hints. Test with Reduce Motion enabled: confetti should not appear on finish screen, transitions should be instant.
  </verify>
  <done>
All permission priming screens have contextual VoiceOver labels with skip explanation timing extended for VoiceOver. OnboardingFinishView respects Reduce Motion for confetti and all animations.
  </done>
</task>

</tasks>

<verification>
Full VoiceOver walkthrough test:
1. Enable VoiceOver in iOS Simulator (Settings > Accessibility > VoiceOver)
2. Launch app (fresh install or reset onboarding)
3. Navigate through entire onboarding flow using only VoiceOver gestures:
   - Swipe right to move forward through elements
   - Double-tap to activate buttons
   - Verify focus moves to title on each step change
4. Verify all buttons have descriptive labels (not just "Button")
5. Verify decorative elements are skipped

Reduce Motion test:
1. Enable Reduce Motion (Settings > Accessibility > Motion > Reduce Motion)
2. Navigate through onboarding:
   - Step transitions should be instant (opacity only)
   - Hero icons should not pulse
   - LogFirstEvent success animation should be instant
   - OnboardingFinish should show no confetti
</verification>

<success_criteria>
- VoiceOver user can complete entire onboarding flow without sighted assistance
- All buttons have contextual accessibility labels and hints
- Focus moves to step title on each transition
- Decorative elements hidden from VoiceOver
- Skip explanation delay extended for VoiceOver users
- Confetti disabled when Reduce Motion enabled
- All animations respect Reduce Motion setting
- Build succeeds with no compiler warnings
</success_criteria>

<output>
After completion, create `.planning/phases/11-accessibility/11-02-SUMMARY.md`
</output>
