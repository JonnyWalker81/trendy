# Milestone v1.1: Onboarding Overhaul

**Status:** SHIPPED 2026-01-21
**Phases:** 8-11
**Total Plans:** 12

## Overview

This milestone fixed the onboarding experience for Trendy iOS. The core problem was a race condition where returning users saw onboarding screens flash before being routed to the main app. The solution required backend storage of onboarding status, a synchronous state architecture on iOS that reads cached state before rendering, and visual polish with modern SwiftUI animations.

Phases were ordered by dependency: backend foundation enabled iOS state management, which enabled visual work, which enabled accessibility polish.

## Phases

### Phase 8: Backend Onboarding Status

**Goal**: Backend stores and serves onboarding completion status per user.
**Depends on**: None (foundation phase)
**Plans**: 2 plans

Plans:
- [x] 08-01-PLAN.md — Database schema and migration for onboarding_status table
- [x] 08-02-PLAN.md — Go API layer (handler/service/repository) with GET/PATCH/DELETE endpoints

**Details:**

Requirements:
- STATE-01: Onboarding completion status stored in backend database (source of truth)
- STATE-02: Backend endpoint to get/set user's onboarding status

Success Criteria:
1. Backend has database table/column storing onboarding completion status per user
2. GET /api/v1/users/onboarding returns current user's onboarding status
3. PATCH /api/v1/users/onboarding updates current user's onboarding status
4. Unauthenticated requests return 401

**Completed:** 2026-01-20

---

### Phase 9: iOS State Architecture

**Goal**: Returning users never see onboarding screens flash on app launch.
**Depends on**: Phase 8 (backend onboarding status)
**Plans**: 3 plans

Plans:
- [x] 09-01-PLAN.md — API models, OnboardingCache, OnboardingStatusService (data layer foundation)
- [x] 09-02-PLAN.md — AppRouter Observable and RootView (routing state machine)
- [x] 09-03-PLAN.md — Remove NotificationCenter routing, wire AppRouter to existing views

**Details:**

Requirements:
- STATE-03: Local cache of onboarding status for fast app launches
- STATE-04: App determines launch state from local cache before any UI renders (no flash)
- STATE-05: Single enum-based route state (`loading`, `onboarding`, `authenticated`)
- STATE-06: Returning users never see onboarding screens
- STATE-07: Unauthenticated returning users go directly to login
- STATE-08: Replace NotificationCenter routing with shared Observable
- STATE-09: Sync onboarding status from backend on login (updates local cache)

Success Criteria:
1. Returning authenticated user launches app and sees main app immediately (no loading screen, no onboarding flash)
2. Returning unauthenticated user launches app and sees login screen immediately (not onboarding)
3. New user completes onboarding, force quits, relaunches - goes to main app (status persisted)
4. User signs out on device A, signs in on device B with completed onboarding - goes to main app (backend sync)
5. No NotificationCenter posts for routing decisions (Observable only)

**Completed:** 2026-01-20

---

### Phase 10: Visual Design & Flow

**Goal**: New users experience a polished, well-ordered onboarding flow with modern design.
**Depends on**: Phase 9 (stable state architecture)
**Plans**: 5 plans

Plans:
- [x] 10-01-PLAN.md — ConfettiSwiftUI package, OnboardingProgressBar, OnboardingHeroView components
- [x] 10-02-PLAN.md — WelcomeView and OnboardingAuthView hero layout redesign
- [x] 10-03-PLAN.md — Permission priming screens (Notification, Location, HealthKit)
- [x] 10-04-PLAN.md — Container navigation with spring animations, LaunchLoadingView polish
- [x] 10-05-PLAN.md — OnboardingFinishView confetti celebration, visual verification

**Details:**

Requirements:
- DESIGN-01: Modern layouts for all onboarding screens
- DESIGN-02: Consistent design language throughout flow
- DESIGN-03: Single loading view matching Launch Screen aesthetic
- DESIGN-04: PhaseAnimator/KeyframeAnimator for polished step transitions
- DESIGN-05: Progress indicator showing steps remaining
- DESIGN-06: Celebration animation on onboarding completion
- FLOW-01: Flow order is Welcome -> Auth -> CreateEventType -> LogFirstEvent -> Permissions -> Finish
- FLOW-02: Pre-permission priming screens explain value before system dialog
- FLOW-03: Skip option available with explanation of what user will miss
- FLOW-04: Each permission request has contextual benefit messaging

Success Criteria:
1. New user sees Welcome screens before being asked to authenticate
2. New user sees custom priming screen before each system permission dialog
3. User can skip permission step and sees explanation of what features require it
4. Step transitions animate smoothly (not instant cuts)
5. Progress indicator visible throughout flow showing current step of total

**Completed:** 2026-01-20

---

### Phase 11: Accessibility

**Goal**: Onboarding is usable with VoiceOver and respects motion preferences.
**Depends on**: Phase 10 (visual design complete)
**Plans**: 2 plans

Plans:
- [x] 11-01-PLAN.md — Shared components accessibility (ProgressBar, HeroView) + navigation focus management
- [x] 11-02-PLAN.md — Screen-by-screen VoiceOver labels, hints, and Reduce Motion handling

**Details:**

Requirements:
- A11Y-01: All onboarding screens support VoiceOver
- A11Y-02: Animations respect `accessibilityReduceMotion` preference

Success Criteria:
1. VoiceOver user can complete entire onboarding flow using only screen reader
2. All interactive elements have accessibility labels and hints
3. User with Reduce Motion enabled sees no animations (instant transitions)
4. Focus order follows visual layout top-to-bottom

**Completed:** 2026-01-21

---

## Milestone Summary

**Key Decisions:**
- user_id is PRIMARY KEY for onboarding_status (one record per user)
- UserDefaults for onboarding cache (fast synchronous access, survives reinstall)
- Per-user keying with userId prefix prevents status leakage between accounts
- determineInitialRoute() is SYNCHRONOUS - no async in hot path
- Cache-first strategy avoids race condition with async session restore
- Spring animation: response 0.3, dampingFraction 0.8 for snappy iOS-native feel
- Skip delay: 1.5s (3.0s for VoiceOver users)
- Confetti: 50 particles, 300 radius, disabled when reduceMotion enabled
- Progress bar announces "stepName, step N of M" format for VoiceOver

**Issues Resolved:**
- Returning users no longer see onboarding screens flash on app launch
- Flow order corrected to Welcome -> Auth -> CreateEventType -> LogFirstEvent -> Permissions -> Finish
- Visual design modernized with hero layouts and spring animations
- Full accessibility support added for VoiceOver and Reduce Motion users

**Issues Deferred:**
- PERS-01: Value-first flow (let user try before requiring auth) — deferred to v1.2
- PERS-02: Contextual permission requests (defer to first feature use) — deferred
- PERS-03: First event celebration with confetti — deferred

**Technical Debt Incurred:**
None. No TODO, FIXME, placeholder, or stub patterns detected in v1.1 code.

---

_For current project status, see .planning/ROADMAP.md (created for next milestone)_

---
*Archived: 2026-01-21 as part of v1.1 milestone completion*
